<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><meta name="description" content="Learn how to build a personal website using Next.js"/><meta property="og:image" content="https://og-image.vercel.app/Next.js%20Sample%20Website.png?theme=light&amp;md=0&amp;fontSize=75px&amp;images=https%3A%2F%2Fassets.vercel.com%2Fimage%2Fupload%2Ffront%2Fassets%2Fdesign%2Fnextjs-black-logo.svg"/><meta name="og:title" content="Next.js Sample Website"/><meta name="twitter:card" content="summary_large_image"/><title>Monitoring an API with jq</title><meta name="next-head-count" content="8"/><link rel="preload" href="/_next/static/css/eb76dd91e5da2f0d.css" as="style"/><link rel="stylesheet" href="/_next/static/css/eb76dd91e5da2f0d.css" data-n-g=""/><link rel="preload" href="/_next/static/css/c39f9723b4064ac0.css" as="style"/><link rel="stylesheet" href="/_next/static/css/c39f9723b4064ac0.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-514908bffb652963.js" defer=""></script><script src="/_next/static/chunks/framework-91d7f78b5b4003c8.js" defer=""></script><script src="/_next/static/chunks/main-dffcc8d986d9cae7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-fc377793a1d2b101.js" defer=""></script><script src="/_next/static/chunks/557-275910878e64eda1.js" defer=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-c05d9255456992c0.js" defer=""></script><script src="/_next/static/cJkc7CsZGj2VcaeVtPgNc/_buildManifest.js" defer=""></script><script src="/_next/static/cJkc7CsZGj2VcaeVtPgNc/_ssgManifest.js" defer=""></script><script src="/_next/static/cJkc7CsZGj2VcaeVtPgNc/_middlewareManifest.js" defer=""></script></head><body><div id="__next"><div class="layout_container__fbLkO"><header class="layout_header__kY0Lt"><a href="/"><img src="/_next/static/media/doesnotexist.6db764b0.jpg" class="utils_borderCircle__s2nTm" height="108" width="108" alt="Your Name"/></a><h2 class="utils_headingLg__5535D"><a class="utils_colorInherit__mSH_x" href="/">Your Name</a></h2></header><main><article><h1 class="utils_headingXl__u25Y2">Monitoring an API with jq</h1><div class="utils_lightText__eUzGY"><time dateTime="2021-12-15">December 15, 2021</time></div><div><p>Say you have an API that returns an array of JSON objects and you want to know when a certain value changes</p>
<p>You could sit there and refresh your browser or hammer the send key in Postman. Or you use a simple curl script to do the work for you</p>
<h3>Given an API that returns JSON in a format like this:</h3>
<pre><code>{
    "results" : [
        {
            "key" : "one",
            "value": "aaa"
        },
        ...
        {
            "key" : "nine",
            "value": "iii"
        }
    ]
}
</code></pre>
<p>We can use this command to poll the API and show the value of a certain key:</p>
<pre><code>while :; do clear;  curl -s {apiEndpoint} | jq '.results[] | select(.key=="{key we want to find}").value' | tail -c +2 | head -c -2 | toilet | lolcat; sleep 5; done
</code></pre>
<h3>A breakdown of the different components:</h3>
<pre><code>while :; do clear; ... ; sleep 5; done
</code></pre>
<p>This is a simple single line infinite loop. There will be a 5 second delay before each iteration and the terminal will be cleared</p>
<pre><code>curl -s {apiEndpoint}
</code></pre>
<p>Call the API. <a href="https://curl.se/docs/manpage.html#-s">-s </a> makes the command silent i.e. you won't see the download process as it pulls down the json</p>
<pre><code>| jq '.results[] | select(.key=="{key we want to find}").value' 
</code></pre>
<p>Use jq to parse the json. Grab everything in the results array and then select the value based on the key
If we pass a key of "nine" we will receive "iii" as the result</p>
<pre><code>| tail -c +2 | head -c -2 
</code></pre>
<p>Strip the leading and tailing quote from the text</p>
<pre><code>| toilet
</code></pre>
<p><a href="https://delightlylinux.wordpress.com/2015/11/13/colored-text-with-toilet/">Toilet</a> is used to format the text so it larger and more readable
There are many optional parameters that you can use to change the style of the text. Figlet is another option you can use</p>
<pre><code>| lolcat
</code></pre>
<p>Add some colour so it looks <a href="https://www.tecmint.com/lolcat-command-to-output-rainbow-of-colors-in-linux-terminal/">fancy</a></p>
</div></article></main><div class="layout_backToHome__9sjx_"><a href="/">‚Üê Back to home</a></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"monitoring-an-api-with-jq","contentHtml":"\u003cp\u003eSay you have an API that returns an array of JSON objects and you want to know when a certain value changes\u003c/p\u003e\n\u003cp\u003eYou could sit there and refresh your browser or hammer the send key in Postman. Or you use a simple curl script to do the work for you\u003c/p\u003e\n\u003ch3\u003eGiven an API that returns JSON in a format like this:\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003e{\n    \"results\" : [\n        {\n            \"key\" : \"one\",\n            \"value\": \"aaa\"\n        },\n        ...\n        {\n            \"key\" : \"nine\",\n            \"value\": \"iii\"\n        }\n    ]\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eWe can use this command to poll the API and show the value of a certain key:\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ewhile :; do clear;  curl -s {apiEndpoint} | jq '.results[] | select(.key==\"{key we want to find}\").value' | tail -c +2 | head -c -2 | toilet | lolcat; sleep 5; done\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eA breakdown of the different components:\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003ewhile :; do clear; ... ; sleep 5; done\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThis is a simple single line infinite loop. There will be a 5 second delay before each iteration and the terminal will be cleared\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003ecurl -s {apiEndpoint}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eCall the API. \u003ca href=\"https://curl.se/docs/manpage.html#-s\"\u003e-s \u003c/a\u003e makes the command silent i.e. you won't see the download process as it pulls down the json\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e| jq '.results[] | select(.key==\"{key we want to find}\").value' \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eUse jq to parse the json. Grab everything in the results array and then select the value based on the key\nIf we pass a key of \"nine\" we will receive \"iii\" as the result\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e| tail -c +2 | head -c -2 \n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eStrip the leading and tailing quote from the text\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e| toilet\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ca href=\"https://delightlylinux.wordpress.com/2015/11/13/colored-text-with-toilet/\"\u003eToilet\u003c/a\u003e is used to format the text so it larger and more readable\nThere are many optional parameters that you can use to change the style of the text. Figlet is another option you can use\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e| lolcat\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAdd some colour so it looks \u003ca href=\"https://www.tecmint.com/lolcat-command-to-output-rainbow-of-colors-in-linux-terminal/\"\u003efancy\u003c/a\u003e\u003c/p\u003e\n","title":"Monitoring an API with jq","date":"2021-12-15"}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"monitoring-an-api-with-jq"},"buildId":"cJkc7CsZGj2VcaeVtPgNc","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>